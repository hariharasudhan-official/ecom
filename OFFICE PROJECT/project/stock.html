<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stock Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background-color: #121212;
      color: #00bfff;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
    }
    h2 {
      color: #00bfff;
      text-align: center;
      margin-bottom: 30px;
    }
    .card {
      background-color: #1e1e1e;
      border: none;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      height: 100%;
    }
    .card.out-of-stock {
      background-color: #2a0000 !important;
      opacity: 0.5;
    }
    .card-body h5,
    .card-body p {
      color: #00bfff;
    }
    .form-control,
    .form-select {
      background-color: #2a2a2a;
      color: #00bfff;
      border: none;
    }
    .form-control::placeholder {
      color: #00bfff;
    }
    .form-control:focus,
    .form-select:focus {
      border: 1px solid #00bfff;
      box-shadow: none;
    }
    .form-select option {
      color: #000;
    }
    .checkout-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      gap: 10px;
    }
    .total-amount {
      font-size: 1.2rem;
      font-weight: bold;
      color: #00bfff;
    }
    .btn-buy-global {
      background-color: #00bfff;
      border: none;
      color: #121212;
      font-size: 1.2rem;
      padding: 12px 20px;
      flex-grow: 1;
    }
    .btn-buy-global:hover {
      background-color: #0086c3;
    }
    .modal-content {
      background-color: #1e1e1e;
      color: #00bfff;
    }
  </style>
</head>
<body>

<h2>üì¶ Current Hanger Stock</h2>
<div class="container">
  <div class="row" id="stockCards"></div>

  <div class="checkout-footer">
    <div class="total-amount">Total: ‚Çπ<span id="totalAmount">0</span></div>
    <button class="btn btn-buy-global" onclick="checkoutSelected()">üõí Buy Selected Items</button>
  </div>
  <a href="order.html" class="btn btn-buy-global mt-4">View My Orders</a>
</div>

<div class="modal fade" id="bookingModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content p-4">
      <h5>üìù Complete Your Order</h5>
      <input type="text" class="form-control mt-3" id="buyerName" placeholder="Your Name" required>
      <input type="text" class="form-control mt-2" id="buyerAddress" placeholder="Shipping Address" required>
      <select class="form-select mt-2" id="paymentMethod">
        <option value="">-- Select Payment Method --</option>
        <option value="Netbanking">Netbanking</option>
        <option value="Paytm">Paytm</option>
        <option value="PhonePe">PhonePe</option>
        <option value="GPay">GPay</option>
      </select>
      <button class="btn btn-buy-global mt-4" onclick="confirmBooking()">Confirm Order</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let defaultHangers = [
    { name: 'Garber', stock: 1200, status: 'Available' },
    { name: 'Walmart', stock: 180, status: 'Few Left' },
    { name: 'BK54', stock: 0, status: 'Out of Stock' },
    { name: '10" TOP', stock: 650, status: 'Available' },
    { name: '12" TOP', stock: 400, status: 'Available' },
    { name: 'WT 10"', stock: 150, status: 'Few Left' },
    { name: 'WT 12"', stock: 850, status: 'Available' },
    { name: '5400-', stock: 700, status: 'Available' },
    { name: 'GB 561', stock: 0, status: 'Out of Stock' }
  ];

  let savedStock = localStorage.getItem('hangerStock');
  let hangers = savedStock ? JSON.parse(savedStock) : defaultHangers;

  hangers = hangers.map((h, i) => ({ ...h, price: h.price || (10 + i) }));

  let selectedItems = [];
  const container = document.getElementById('stockCards');

  function renderCards() {
    container.innerHTML = "";
    hangers.forEach((hanger, index) => {
      const isOut = hanger.status === "Out of Stock" || hanger.stock === 0;
      container.innerHTML += `
        <div class="col-md-4 mb-4">
          <div class="card h-100 ${isOut ? 'out-of-stock' : ''}">
            <div class="card-body text-center">
              <h5>${hanger.name}</h5>
              <p>Status: ${hanger.status}</p>
              <p>Stock: ${hanger.stock}</p>
              <p>Price: ‚Çπ${hanger.price} per hanger</p>
              <input type="number" class="form-control mb-3 text-center" 
                id="qty-${index}" placeholder="Enter quantity" 
                min="0" max="${hanger.stock}" 
                ${isOut ? 'disabled' : ''} 
                oninput="validateQuantity(${index})">
            </div>
          </div>
        </div>
      `;
    });
  }

  function validateQuantity(index) {
    const input = document.getElementById(`qty-${index}`);
    const max = hangers[index].stock;
    const value = parseInt(input.value);
    if (value > max) {
      alert(`Only ${max} hangers available for ${hangers[index].name}`);
      input.value = max;
    }
    updateTotal();
  }

  function updateTotal() {
    let total = 0;
    hangers.forEach((hanger, index) => {
      const input = document.getElementById(`qty-${index}`);
      if (!input || input.disabled) return;
      const qty = parseInt(input.value);
      if (!isNaN(qty) && qty > 0 && qty <= hanger.stock) {
        total += qty * hanger.price;
      }
    });
    document.getElementById("totalAmount").innerText = total;
  }

  function checkoutSelected() {
    selectedItems = [];
    hangers.forEach((hanger, index) => {
      const input = document.getElementById(`qty-${index}`);
      if (!input || input.disabled) return;
      const qty = parseInt(input.value);
      if (!isNaN(qty) && qty > 0) {
        if (qty > hanger.stock) {
          alert(`‚ùå Cannot exceed stock limit for ${hanger.name}`);
          return;
        }
        selectedItems.push({ ...hanger, qty });
      }
    });

    if (selectedItems.length === 0) {
      alert("Please select at least one valid item.");
      return;
    }

    const modal = new bootstrap.Modal(document.getElementById("bookingModal"));
    modal.show();
  }

  function confirmBooking() {
    const nameInput = document.getElementById("buyerName");
    const addressInput = document.getElementById("buyerAddress");
    const paymentSelect = document.getElementById("paymentMethod");

    const name = nameInput.value.trim();
    const address = addressInput.value.trim();
    const payment = paymentSelect.value;

    if (!name || !address) {
      alert("Please fill out all fields.");
      return;
    }

    let total = 0;
    selectedItems.forEach(item => {
      total += item.qty * item.price;
    });

    const now = new Date();
    const orderTime = now.toLocaleString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });

    const order = {
      id: Date.now(),
      items: selectedItems,
      customerName: name,
      customerAddress: address,
      paymentMethod: payment || "Not Paid",
      totalAmount: total,
      orderTime: orderTime
    };

    let allOrders = JSON.parse(localStorage.getItem('orders')) || [];
    allOrders.push(order);
    localStorage.setItem('orders', JSON.stringify(allOrders));

    selectedItems.forEach(item => {
      const idx = hangers.findIndex(h => h.name === item.name);
      if (idx !== -1) hangers[idx].stock -= item.qty;
    });

    localStorage.setItem('hangerStock', JSON.stringify(hangers));

    renderCards();
    updateTotal();

    alert(`‚úÖ Order Placed Successfully!\n\nTime: ${orderTime}`);

    nameInput.value = "";
    addressInput.value = "";
    paymentSelect.value = "";

    const modalElement = document.getElementById("bookingModal");
    const modalInstance = bootstrap.Modal.getInstance(modalElement);
    modalInstance.hide();
  }

  renderCards();
</script>

</body>
</html>
